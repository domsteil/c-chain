{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport axios from 'axios';\nimport { deflateSync } from 'zlib';\nimport Web3 from 'web3';\nimport Fortmatic from 'fortmatic';\nimport useUrsula from \"../useUrsula\";\nvar web3;\nvar state;\nvar captureFile;\nvar onSubmit;\nvar uploadFile;\nvar address;\nvar fm = new Fortmatic('pk_test_F4970AF6BBC7F0C1');\n\nif (process.browser) {\n  web3 = new Web3(fm.getProvider());\n}\n\nfunction useAsyncEndpoint(fn) {\n  var _this = this;\n\n  var _useState = useState({\n    data: null,\n    pending: deflateSync,\n    completed: false,\n    error: false\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      res = _useState2[0],\n      setRes = _useState2[1];\n\n  var _useState3 = useState(),\n      _useState4 = _slicedToArray(_useState3, 2),\n      req = _useState4[0],\n      setReq = _useState4[1];\n\n  state = {\n    ipfsHash: null,\n    buffer: '',\n    ethAddress: '',\n    transactionHash: '',\n    txReceipt: ''\n  }; //Take file input from user\n\n  captureFile = function captureFile(event) {\n    event.stopPropagation();\n    event.preventDefault();\n    var file = event.target.files[0];\n    var reader = new window.FileReader();\n    reader.readAsArrayBuffer(file);\n\n    reader.onloadend = function () {\n      return _this.convertToBuffer(reader);\n    };\n  };\n\n  uploadFile = useUrsula(\"http://ec2-18-204-34-34.compute-1.amazonaws.com:5000/upload\");\n\n  onSubmit =\n  /*#__PURE__*/\n  function () {\n    var _ref = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(event) {\n      var accounts;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault();\n              _context.next = 3;\n              return web3.eth.getAccounts();\n\n            case 3:\n              accounts = _context.sent;\n              _context.next = 6;\n              return ipfs.add(_this.state.buffer, function (err, ipfsHash) {\n                console.log(err, ipfsHash); //setState by setting ipfsHash to ipfsHash[0].hash\n\n                _this.setState({\n                  ipfsHash: ipfsHash[0].hash\n                });\n\n                storehash.methods.sendHash(_this.state.ipfsHash).send({\n                  from: accounts[0]\n                }, function (error, transactionHash) {\n                  console.log(transactionHash);\n\n                  _this.setState({\n                    transactionHash: transactionHash\n                  });\n                });\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    if (!req) return;\n    setRes({\n      data: null,\n      pending: true,\n      completed: false,\n      error: false\n    });\n    axios(req).then(function (res) {\n      return setRes({\n        data: res.data,\n        pending: false,\n        error: false,\n        complete: true\n      });\n    }).catch(function () {\n      return setRes({\n        data: null,\n        pending: false,\n        error: true,\n        complete: true\n      });\n    });\n  }, [req]);\n  return [res, function () {\n    return setReq(fn.apply(void 0, arguments));\n  }];\n}\n\nvar verifyData;\n\nfunction retrieveData() {\n  return us;\n}\n\nvar handlePersonalSign = function handlePersonalSign(e) {\n  var message = message;\n  web3.eth.getAccounts(function (err, accounts) {\n    if (err) return console.error(err);\n    var from = accounts[0];\n    var params = [message, from];\n    var method = 'personal_sign';\n    web3.currentProvider.sendAsync({\n      id: 1,\n      method: method,\n      params: params,\n      from: from\n    }, function (err, result) {\n      if (err) return console.error(err);\n      if (result.error) return console.error(result.error);\n      console.log(result);\n    });\n  });\n};\n\nvar publisherAPI = \"http://ec2-18-204-34-34.compute-1.amazonaws.com:5000/upload\";\n\nfunction postPublisherEndpoint() {\n  return useAsyncEndpoint(function (data) {\n    return {\n      url: publisherAPI,\n      method: \"POST\",\n      data: data\n    };\n  });\n}\n\nexport default function MessageBar(props) {\n  var _useState5 = useState(\"Public Key for re-encryption\"),\n      _useState6 = _slicedToArray(_useState5, 2),\n      message = _useState6[0],\n      setMessage = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      _useState8 = _slicedToArray(_useState7, 2),\n      to = _useState8[0],\n      setTo = _useState8[1];\n\n  var _useState9 = useState(\"\"),\n      _useState10 = _slicedToArray(_useState9, 2),\n      who = _useState10[0],\n      setWho = _useState10[1];\n\n  var _postPublisherEndpoin = postPublisherEndpoint(),\n      _postPublisherEndpoin2 = _slicedToArray(_postPublisherEndpoin, 2),\n      newMessage = _postPublisherEndpoin2[0],\n      postNewMessage = _postPublisherEndpoin2[1];\n\n  var handleKeyPress = function handleKeyPress(event) {\n    if (event.key == 'Enter' || event.keyCode == 13) {\n      handlePersonalSign();\n    }\n  };\n\n  return React.createElement(\"section\", {\n    className: \"jsx-3351249942\"\n  }, React.createElement(\"div\", {\n    className: \"jsx-3351249942\" + \" \" + \"row\"\n  }, React.createElement(\"div\", {\n    className: \"jsx-3351249942\" + \" \" + \"column\"\n  }, React.createElement(\"form\", {\n    id: \"ipfs-hash-form\",\n    className: \"jsx-3351249942\"\n  }, React.createElement(\"input\", {\n    type: \"file\",\n    className: \"jsx-3351249942\" + \" \" + \"ipfsInput\"\n  }), React.createElement(\"button\", {\n    onClick: \"upload\",\n    className: \"jsx-3351249942\" + \" \" + \"policyButton\"\n  }, \"Upload\"), React.createElement(\"img\", {\n    src: \"../static/verification.png\",\n    height: \"28\",\n    width: \"28\",\n    align: \"middle\",\n    alt: \"\",\n    className: \"jsx-3351249942\" + \" \" + \"center\"\n  })), React.createElement(\"br\", {\n    className: \"jsx-3351249942\"\n  }), React.createElement(\"input\", {\n    value: message,\n    onChange: function onChange(e) {\n      return setMessage(e.target.value);\n    },\n    onKeyPress: handleKeyPress,\n    className: \"jsx-3351249942\" + \" \" + \"message-box\"\n  }), React.createElement(\"a\", {\n    className: \"jsx-3351249942\"\n  }, React.createElement(\"button\", {\n    onClick: verifyData,\n    invert: true,\n    className: \"jsx-3351249942\" + \" \" + \"policyButton\"\n  }, \"Verify\"), React.createElement(\"img\", {\n    src: \"../static/verification.png\",\n    height: \"28\",\n    width: \"28\",\n    align: \"middle\",\n    alt: \"\",\n    className: \"jsx-3351249942\" + \" \" + \"center\"\n  })))), React.createElement(_JSXStyle, {\n    id: \"3351249942\"\n  }, [\".column.jsx-3351249942{text-align:center;border-width:1px;list-style:none;padding-bottom:8px;padding-top:8px;margin-right:28px;}\", \".center.jsx-3351249942{margin-left:3px;margin-bottom:10px;}\", \".to.jsx-3351249942{width:260px;padding-bottom:8px;padding-top:8px;border:1px solid #d0d4d9;border-radius:.375rem;-webkit-box-shadow:inset 0 -1px 0 0 rgba(100,121,143,0.122);box-shadow:inset 0 -1px 0 0 rgba(100,121,143,0.122);line-height:20px;min-height:auto;padding-left:0;padding-right:0;}\", \".policyButton.jsx-3351249942{-webkit-appearance:none;position:relative;display:inline-block;vertical-align:middle;text-transform:uppercase;text-align:center;line-height:0;white-space:nowrap;width:120px;height:30px;margin-left:8px;font-weight:500;font-size:12px;color:rgb(102,102,102);background-color:rgb(255,255,255);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;-webkit-text-decoration:none;text-decoration:none;padding:0px 10px;margin-bottom:2px;border-radius:5px;border-width:1px;border-style:solid;border-color:rgb(234,234,234);border-image:initial;-webkit-transition:all 0.2s ease 0s;transition:all 0.2s ease 0s;overflow:hidden;outline:none;}\", \".ipfsInput.jsx-3351249942{-webkit-appearance:none;position:relative;display:inline-block;vertical-align:middle;text-transform:uppercase;text-align:center;line-height:0;white-space:nowrap;width:300px;height:30px;margin-left:8px;font-weight:500;font-size:12px;color:#000;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;-webkit-text-decoration:none;text-decoration:none;padding:0px 10px;margin-bottom:2px;border-radius:5px;border-width:1px;border-style:solid;border-color:rgb(234,234,234);border-image:initial;-webkit-transition:all 0.2s ease 0s;transition:all 0.2s ease 0s;overflow:hidden;outline:none;}\", \".message-box.jsx-3351249942{padding-bottom:28px;width:800px;overflow:auto;margin:0;min-height:42px;height:38px;max-height:180px;border:2px solid rgba(134,134,134,.7);border-radius:.375rem;outline:0;background:#fff;resize:none;box-shadow:none;color:#1d1c1d;-webkit-user-select:auto;-moz-user-select:auto;-ms-user-select:auto;-webkit-user-select:auto;-moz-user-select:auto;-ms-user-select:auto;user-select:auto;padding:9px 30px 10px 50px;\\\"      }      .login {        color: #FFF;      }      .account {        font-size: 13px;        line-height: 1.91667;        font-weight: 400;        color: #3d464d;        border: 1px solid #bdc4c9;        padding: 3.5px 7px;        border-radius: 4px;        margin-top: 28px;        margin-left: 8px;      }      .row {        flex-direction: column;        margin: -1.5rem 0;        text-align: center;      }      // CSS only media query for tablet      @media screen and (max-width: 960px) {        .row {          flex-direction: column;          margin: -1.5rem 0;        }        .column {          width: 10%;          padding: 1.5rem 0;          text-align: center;          max-width: 100px;        }        .message-box {          padding-bottom: 28px;          width: 100px;          overflow: auto;          margin: 0;           min-height: 42px;           height: 38px;           max-height: 180px;           border: 2px solid rgba(134,134,134,.7);          border-radius: .375rem;          outline: 0;          background: #FFFFFF;          resize: none;          box-shadow: none;          color: #1d1c1d;          -webkit-user-select: auto;          -moz-user-select: auto;          -ms-user-select: auto;          user-select: auto;          padding: 9px 30px 10px 50px;          display: none;        }              };}\"]));\n}","map":null,"metadata":{},"sourceType":"module"}